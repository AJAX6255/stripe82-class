import sys
import os
import pandas as pd
import numpy as np
from gatspy import periodic

#Creating the labeled csv files

a = 'folder' #folder containing lightcurve data in '.dat' format
for filename in os.listdir(a):
       infilename = os.path.join(a,filename)
       if not os.path.isfile(infilename): continue
       oldbase = os.path.splitext(filename)
       newname = infilename.replace('.dat', '.csv')
       output = os.rename(infilename, newname)


#Period estimation for a single lightcurve file 
df = pd.read_csv('LC_13350.csv',  header=None,sep=' ') #Load your light curve file as a csv
#Cleaning the data
df = df[df.ix[:,2] >= 0] 
df = df[~df.ix[:,0].str.contains("#")]
df.head()


time = map(float,df.ix[:,0].values) 
mags = map(float,df.ix[:,2].values)
dmags = map(float,df.ix[:,3].values)
filters = df.ix[:,1].values


#sys.stdout = open(os.devnull,"w") #To prevent printing intermediate results by in-built functions
ls = periodic.LombScargleMultiband(fit_period=True); #For finding periodicity in irregularly sampled multiband data
ls.optimizer.period_range = (0.2, 1.0)
ls.fit(time,mags,dmags,filters)
period = ls.best_period
#sys.stdout = sys.__stdout__
print period 

#Plotting the folded light curves for each band
fig = plt.figure(figsize=(14, 5))
gs = plt.GridSpec(5, 2, left=0.10, right=0.95, bottom=0.15,
                  wspace=0.3, hspace=0.6)
ax = [fig.add_subplot(gs[:, 0])]

for band, mask in zip('ugriz', masks):
    ax[0].errorbar(foldTimes[mask], mags[mask], yerr=dmags[mask],fmt='.',label=band)

ax[0].set_ylim(20, 17)
ax[0].legend(loc='lower right', fontsize=8, ncol=3)
ax[0].set_title('Folded Data', fontsize=12)
ax[0].set_xlabel('phase')
ax[0].set_ylabel('magnitude')
plt.show()
